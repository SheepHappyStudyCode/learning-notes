# 用户管理中心

## 1 自动代码生成器使用

1. 自动代码生成

   右击数据表，使用mybatisx插件生成代码。

2. mp自动将驼峰转下划线，如果不想这样映射需要修改配置文件。

## 2 注册逻辑
1. 用户在前端输入账户和密码，以及**校验码**。

2. 校验用户的账号和密码

    - 非空

    - 账户均**不小于**4位
    - 密码**不小于**8位
    - 账户不能重复
    - 账户不包含特殊字符
    - 密码和校验码相同

3. **对密码进行加密**（密码不能明文存储在数据库）

4. 向数据库插入用户数据

## 3 注册校验

1. 使用commons-lang的StringUtils帮助校验非空

## 4 登录逻辑

### 4.1 请求格式

接收参数：用户账号、密码

请求类型：POST

> 请求参数很长时不建议用get

请求体：JSON格式的数据

返回值：用户信息（**脱敏**）

### 4.2 流程

1. 校验用户账号和密码是否合法

   - 非空

   - 账户均**不小于**4位

   - 密码**不小于**8位

   - 账户不包含特殊字符

2. 校验密码
3. 记录用户的登录态（session），将其存到服务器上。
4. 返回用户信息

### 4.3 如何知道是哪个用户登录

1. 连接服务器后，得到一个session1状态（匿名会话），返回给前端
2. 登录成功后，得到登录成功的session，返回给前端一个设置cookie的命令
3. 前端接收到后端的命令后（相同的域名），在请求头中带上cookie请求
4. 后端拿到前端传来的cookie，找到对应的session
5. 后端从session中可以取出基于该session存储的变量

## 4.4 HttpServletRequest获取用户状态的机制

`HttpServletRequest` 的 `getSession` 方法用于获取当前会话。如果当前请求已经有一个会话，那么 `getSession` 方法将返回这个会话。如果当前请求没有会话，那么 `getSession` 方法将创建一个新的会话。

会话（Session）是一种在服务器端存储用户数据的机制。当一个用户访问一个网站时，服务器会为这个用户创建一个会话，并将这个会话的 ID 发送给用户。用户在后续的请求中会将这个会话 ID 发送给服务器，服务器就可以根据这个会话 ID 找到对应的会话，从而获取用户的数据。

在 Java Servlet 中，你可以使用 `HttpSession` 接口来操作会话。`HttpSession` 接口提供了一些方法，用于存储和获取会话中的数据。例如，你可以使用 `setAttribute` 方法将数据存储在会话中，使用 `getAttribute` 方法从会话中获取数据。

## 5 项目部署上线

### 5.1 多环境

1. 多环境：指同一套项目在不同阶段需要根据实际情况来调整配置并且部署到不同的机器上。
2. 多环境的作用：
   - 每个环境互不影响
   - 区分不同的阶段：开发 / 测试 / 生产
   - 对项目进行优化
     1. 本地日志级别
     2. 精简依赖， 节省项目体积
     3. 项目的环境 / 参数可以调整
3. 多环境分类：
   - 本地环境
   - 开发环境（远程开发），大家连同一台电脑
   - 测试环境：性能测试、功能测试、系统继承测试，独立的数据库、独立的服务器
   - 预发布环境：和正式环境一致，正式数据库
   - 正式环境：尽量不要改动
   - 沙箱环境（实验环境）：为了做实现

### 5.2 后端多环境

1. 在配置文件名的后面加上环境，例如，生产环境配置用`application-prod.yml`
2. 可以在启动项目时添加参数

## 6 跨域问题的解决方案

1. 把域名、端口改成相同的
2. 网关支持



