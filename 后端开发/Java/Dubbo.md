﻿﻿﻿﻿﻿# Dubbo
## 1 分布式系统中的相关概念
### 1.1 大型互联网项目架构目标
1. 传统项目和互联网项目的区别：用户基数不同，用户忍耐度不同
2. 用户体验：美观、功能、速度、稳定性
3. 互联网项目特点：
	- 用户多
	- 流量大，并发高
	- 海量数据
	- 易受攻击
	- 功能繁琐
	- 变更快
### 1.2 集群和分布式
1. 集群：多个机器做同一件事
2. 分布式：多个机器做不同的事，简单来说就是将一个项目分为各个模块，将这些模块部署到不同的机器上。、
### 1.3 架构演进
单体架构 ---> 垂直架构 ---> 分布式架构 ---> SOA架构 ---> 微服务架构
## 2 Dubbo概述
Dubbo是阿里巴巴开源的一个高性能、轻量级的JavaRPC框架。

![image-20240610112246543](https://gitee.com/SheeepHappy/blog-pic/raw/master/20250430160539414.png)

## 3 Dubbo快速入门
### 3.1 实现步骤
1.创建服务提供者Provider模块
2.创建服务消费者Consumer模块
3.在服务提供者模块编写UserServiceImpl提供服务
4.在服务消费者中的UserController远程调用UserServiceImpl提供的服务
5.分别启动两个服务，测试

### 3.2 服务提供者
1. 业务层的实现类加上dubbo的@Service注解
2. 在配置文件添加dubbo的相关配置

### 3.3 服务消费者
1. 服务接口加上@Reference注解
2. 添加配置
3. 可以创建一个公共的接口模块，被其他模块依赖

## 4 Dubbo高级特性
### 4.1 dubbo-admin管理平台
1. 简介：dubbo-admin管理平台，是**图形化的服务管理界面**。能够从注册中心获取到所有的提供者/消费者进行**配置管理**。
2. 使用步骤：
   - 下载node.js
   - 从github下载dubbo-admin项目
   - 对开源项目做dubbo的配置，然后启动项目

### 4.2 高级特性
#### 4.2.1 序列化
1. 引入：![image-20240614103004251](https://gitee.com/SheeepHappy/blog-pic/raw/master/20250430160539415.png)
2. 实现序列化：
   - dubbo内部已经实现了序列化和反序列化
   - 实体类需要实现Serializable接口

#### 4.2.2 地址缓存
1. 注册中心挂了，服务是否可以正常访问？
	- 可以。因为dubbo服务消费者在第一次调用时，会**将服务提供方地址缓存到本地**，以后在调用时则不会访问注册中心。
	- 当服务提供者地址发生变化时，注册中心会通知服务消费者。
#### 4.2.3 超时与重试
1. 问题：服务消费者在调用提供者时发生阻塞、等待的情形，这个时候消费者会一直等待下去。如果同时有大量请求发生阻塞，多线程堆积，会造成雪崩。
2. 解决方案：设置一个超时时间，超时就报错。
3. 具体操作：
	- 在服务提供者的Service注解设置timeout，默认是1s。一般超时时间配置在服务提供方。
	- 设置timeout外，还要设置重试retries，以防因为网络抖动而无法访问。

#### 4.2.4 多版本
1. 灰度发布：服务提供方升级后，让一部分用户使用新版的服务提供方，用户反馈没有问题，在将所有的服务消费者迁移到新版的服务提供者。
2. dubbo使用version属性来设置和调用同一个接口的不同版本。

#### 4.2.5 负载均衡
1. 负载均衡策略：
	- Random：按权重随机，默认值。
	- RoundRobin：按权重轮询。
	- LeastActive：最少活跃调用数，相同活跃数随机。
	- ConsistentHash：一直性Hash。
2. 服务方通过weight属性配置， 消费者Rederence注解配置。

#### 4.2.6 集群容错
集群容错模式：
   - Failover Cluster：失败重试，默认值，一般用于读操作。
   - Failfast Cluster：快速失败，只发起一次调用，不重试，通常用于写操作。
   - Failsafe Cluster：失败安全。出现异常直接忽略，返回空结果。
   - Failback Cluster：失败自动恢复
   - Forking Cluster
   - Broadcast Cluster

#### 4.2.7 服务降级
1. 作用：使某个不重要的服务停用。
2. 服务降级方式：
	- mock=force:return null：消费方对服务方的调用全都返回空值
	- mock=fail:return null：调用失败时返回null